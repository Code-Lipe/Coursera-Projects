---
title: "Manipulação de dados com dplyr em R"
output: html_notebook
---

Bem-vindo ao projeto: Manipulação de dados com dplyr em R. Neste projeto, você aprenderá como manipular dados com o pacote dplyr em R. Ao final deste projeto, você entenderá como usar diferentes verbos dplyr, como o verbo de seleção, o verbo de filtro, o verbo de organização, o verbo de mutação, o verbo de resumo e o verbo group_by para manipular o conjunto de dados do gapminder. Além disso, você aprenderá como combinar diferentes verbos dplyr para manipular o conjunto de dados gapminder para obter o resultado desejado. Observe que você não precisa ser um analista de dados especialista, cientista de dados ou analista estatístico para ter sucesso neste projeto guiado, apenas uma familiaridade com a linguagem R será suficiente.

## **Sobre o Tidyverse**

O [tidyverse](https://tidyverse.org) é uma **coleção opinativa de pacotes R** projetados para ciência de dados. Todos os pacotes compartilham uma filosofia de design subjacente, gramática e estruturas de dados.

### 1. **Instalando e Conhecendo os Pacotes**

O [dplyr](https://dplyr.tidyverse.org) é uma gramática de manipulação de dados que fornece um conjunto consistente de verbos que ajudam você a resolver os desafios mais comuns de manipulação de dados. Já o **Gapminder data** são trechos dos dados do Gapminder sobre expectativa de vida, PIB per capita e população por país.

```{r}
install.packages("dplyr")
install.packages("gapminder")

library(dplyr)
library(gapminder)
```

### 2. **Olhando o Dataset e Checando a Estrutura**

O [glimpse()](https://dplyr.tidyverse.org/reference/glimpse.html) é como uma versão transposta de print() e str(): as colunas percorrem a página e os dados são executados. Isso torna possível ver todas as colunas em um quadro de dados. É um pouco como aplicado a um quadro de dados mas ele tenta mostrar o máximo de dados possível (e sempre mostra os dados subjacentes, mesmo quando aplicado para uma fonte de dados remota.) O [str()](https://rdrr.io/r/utils/str.html) exibe de forma compacta a estrutura interna de um objeto R.

```{r}
# Observando o dataset
gapminder

# Conhecendo a estrutura
glimpse(gapminder)

# O mesmo objetivo do glimpse
str(gapminder) 
```

### 3. **O Verbo Select**

O [select()](https://sparkbyexamples.com/r-programming/r-select-function-from-dplyr/) é uma função do pacote R que é usada para selecionar variáveis de quadro de dados por nome/índice e também é usada para renomear variáveis ao selecionar e descartar variáveis por nome.

```{r}
# Selecione as colunas de país e continente
gapminder %>%
  select(country, continent)

# Armazene o resultado em uma variável chamada country_con
country_con <- gapminder %>%
  select(country, continent)
```

### 4. **O Verbo Filter**

O [filter()](https://sparkbyexamples.com/r-programming/r-dplyr-filter/) do package **dplyr** é usada para filtrar as linhas do quadro de dados em R. Observe que filter() não filtra os dados, em vez disso, retém todas as linhas que satisfazem a condição especificada.

```{r}
# Filtrar o conjunto de dados gapminder para o ano de 1962
gapminder %>%
  filter(year == 1962)

# Filtro para China em 2002
gapminder %>%
  filter(year == 2002, country == "China")
```

### 5. **O Verbo Arrange**

O [arrange()](https://dplyr.tidyverse.org/reference/arrange.html) ordena as linhas de um quadro de dados pelos valores de selecionado Colunas.

```{r}
# Classificar em ordem crescente de lifeExp
gapminder %>%
arrange(lifeExp)

# Classificar em ordem decrescente de lifeExp e selecionar os quinze primeiros
gapminder %>%
arrange(desc(lifeExp)) %>%
slice(1:15)

# Filtrar para o ano 1962,
# então organizar em ordem decrescente de população
gapminder %>%
filter(year == 1962) %>%
arrange(desc(pop))
```

### 6. **O Verbo Mutate**

O [mutate()](https://dplyr.tidyverse.org/reference/mutate.html) cria novas colunas que são funções de variáveis existentes. Ele também pode modificar (se o nome for o mesmo que um existente column) e exclua colunas (definindo seu valor como NULL).

```{r}
# Use mutate para mudar lifeExp para months
gapminder %>%
mutate(lifeExp = 12 * lifeExp)

# Use mutate para criar uma nova coluna chamada lifeExpMonths
gapminder %>%
mutate(lifeExpMonths = 12 * lifeExp)

# Filtre, altere e organize o conjunto de dados gapminder
# Recupere a expectativa de vida em meses para o ano de 2007.
# Armazene o resultado em uma nova coluna chamada lifeExpMonths
# Classifique o resultado em ordem decrescente
gapminder %>%
filter(year == 2007) %>%
mutate(lifeExpMonths = 12 * lifeExp) %>%
arrange(desc(lifeExpMonths))
```

### 7. **O Verbo Summarise**

O [summarise()](https://dplyr.tidyverse.org/reference/summarise.html) cria um novo quadro de dados. Ele retorna uma linha para cada combinação de variáveis de agrupamento; Se não houver variáveis de agrupamento, a saída terá uma única linha resumindo todas as observações na entrada. Ela conterá uma coluna para cada variável de agrupamento e uma coluna para cada uma das as estatísticas resumidas que você especificou.

```{r}
# Resumir para encontrar a expectativa de vida média
gapminder %>%
summarise(medianLifeExp = median(lifeExp))

# Filtrar para 1962 e então resumir a expectativa de vida média
gapminder %>%
filter(year == 1962) %>%
summarise(medianLifeExp = median(lifeExp))

# Filtrar para 1962 e então resumir a expectativa de vida média
# e o PIB per capita máximo
gapminder %>%
filter(year == 1962) %>%
summarise(medianLifeExp = median(lifeExp), maxGdpPerCap = max(gdpPercap))
```

### 8. **O Verbo Group_by**

A maioria das operações de dados é feita em grupos definidos por variáveis. O [group_by()](https://dplyr.tidyverse.org/reference/group_by.html) pega um tbl existente e o converte em um tbl agrupado onde as operações são realizadas "por grupo".

```{r}
# Encontre a expectativa de vida média e o PIB per capita máximo em cada ano
gapminder %>%
group_by(year) %>%
summarise(medianLifeExp = median(lifeExp),
maxGdpPerCap = max(gdpPercap))

# Encontre a expectativa de vida média e o PIB per capita máximo
# em cada continente em 1962
gapminder %>%
filter(year == 1962) %>%
group_by(continent) %>%
summarise(medianLifeExp = median(lifeExp),
maxGdpPerCap = max(gdpPercap))

# Encontre a expectativa de vida média e o PIB per capita máximo
# em cada combinação continente/ano
gapminder %>%
group_by(year, continent) %>%
summarise(medianLifeExp = median(lifeExp),
maxGdpPerCap = max(PIBPercap))
```
